{"version":3,"file":"iv-viewer-ts.mjs","sources":["../src/util.ts","../src/Slider.ts","../src/ImageViewer.ts","../src/FullScreen.ts"],"sourcesContent":["// constants\nexport const ZOOM_CONSTANT = 15; // increase or decrease value for zoom on mouse wheel\nexport const MOUSE_WHEEL_COUNT = 5; // A mouse delta after which it should stop preventing default behaviour of mouse wheel\n\nexport const noop = new Function();\n\n// ease out method\n/*\n    t : current time,\n    b : intial value,\n    c : changed value,\n    d : duration\n*/\nexport function easeOutQuart (\n  currentTime: number,\n  startValue: number,\n  changedValue: number,\n  duration: number,\n): number {\n  currentTime /= duration;\n  currentTime -= 1;\n  return (\n    -changedValue *\n      (currentTime * currentTime * currentTime * currentTime - 1) +\n      startValue\n  );\n}\n\ninterface CreateElementOptions {\n  tagName: string;\n  id?: string;\n  html?: string;\n  className?: string;\n  src?: string;\n  style?: string;\n  child?: Node;\n  parent: Node;\n  insertBefore?: Node;\n}\n\nexport function createElement (options: CreateElementOptions) {\n  const elem = document.createElement(options.tagName);\n  if (options.id) elem.id = options.id;\n  if (options.html) elem.innerHTML = options.html;\n  if (options.className) elem.className = options.className;\n  if (options.src && elem instanceof HTMLImageElement) elem.src = options.src;\n  if (options.style) elem.style.cssText = options.style;\n  if (options.child) elem.appendChild(options.child);\n\n  // Insert before\n  if (options.insertBefore) {\n    options.parent.insertBefore(elem, options.insertBefore);\n\n  // Standard append\n  } else {\n    options.parent.appendChild(elem);\n  }\n\n  return elem;\n}\n\n// method to add class\nexport function addClass (el: HTMLElement, className: string): void {\n  const classNameAry = className.split(' ');\n\n  if (classNameAry.length > 1) {\n    classNameAry.forEach((classItem) => addClass(el, classItem));\n  } else if (el.classList) {\n    el.classList.add(className);\n  } else {\n    el.className += ` ${className}`;\n  }\n}\n\n// method to remove class\nexport function removeClass (el: HTMLElement, className: string): void {\n  const classNameAry = className.split(' ');\n\n  if (classNameAry.length > 1) {\n    classNameAry.forEach((classItem) => removeClass(el, classItem));\n  } else if (el.classList) {\n    el.classList.remove(className);\n  } else {\n    el.className = el.className.replace(\n      new RegExp(`(^|\\\\b)${className.split(' ').join('|')}(\\\\b|$)`, 'gi'),\n      ' ',\n    );\n  }\n}\n\n// function to check if image is loaded\nexport function imageLoaded (img: any): boolean {\n  return (\n    img.complete &&\n      (typeof img.naturalWidth === 'undefined' || img.naturalWidth !== 0)\n  );\n}\n\nexport function toArray(list: Node | NodeList | HTMLCollectionOf<HTMLElement>): (HTMLCollectionOf<Element> | Element)[] {\n  if (list instanceof HTMLElement) {\n    return [list];\n  } else if (list instanceof NodeList || list instanceof HTMLCollection) {\n    return Array.prototype.slice.call(list);\n  } else {\n    return [];\n  }\n}\n\n\n\n\ntype AnyObject = { [key: string]: any };\nexport function assign (target: AnyObject, ...rest: AnyObject[]): AnyObject {\n  rest.forEach((obj) => {\n    Object.keys(obj).forEach((key) => {\n      target[key] = obj[key];\n    });\n  });\n  return target;\n}\n\n//Node | NodeList | HTMLCollectionOf<HTMLElement>\nexport function css(elements: any, properties: any): string | undefined {\n  const elmArray = toArray(elements);\n\n  if (typeof properties === 'string') {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    return window.getComputedStyle(<Element>elmArray[0])[properties];\n  }\n\n  elmArray.forEach((element) => {\n    Object.keys(properties).forEach((key:any) => {\n      (element as HTMLElement).style[key] = properties[key];\n    });\n  });\n\n  return undefined;\n}\n\n\n\nexport function removeCss(element: HTMLElement, property: string): void {\n  element.style.removeProperty(property);\n}\n\nexport function wrap(element: HTMLElement, { tag = 'div', className, id, style }: { tag?: string, className?: string, id?: string, style?: { display?: string, overflow?: string } }): HTMLElement {\n  const wrapper = document.createElement(tag);\n  if (className) wrapper.className = className;\n  if (id) wrapper.id = id;\n  if(style) {\n    if (style.display) wrapper.style.display = style.display;\n    if (style.overflow) wrapper.style.overflow = style.overflow;\n  }\n\n  const parentNode = element.parentNode;\n  if (!parentNode) {\n    throw new Error('element does not have a parent node');\n  }\n  parentNode.insertBefore(wrapper, element);\n  parentNode.removeChild(element);\n  wrapper.appendChild(element);\n  return wrapper;\n}\n\n\nexport function unwrap(element: HTMLElement) {\n  const parent = element.parentNode as HTMLElement;\n\n  if (parent && parent !== document.body) {\n    parent.parentNode?.insertBefore(element, parent);\n    parent.parentNode?.removeChild(parent);\n  }\n}\n\nexport function remove(elements: NodeListOf<Element>): void {\n  const elmArray = toArray(elements);\n  elmArray.forEach((element : any) => {\n    if (element.parentNode) {\n      element.parentNode.removeChild(element);\n    }\n  });\n}\n\nexport function clamp(num: number, min: number, max: number): number {\n  return Math.min(Math.max(num, min), max);\n}\n\nexport function assignEvent(\n    element: HTMLElement,\n    events: string | string[],\n    handler: any,\n): () => void {\n  const eventList = Array.isArray(events) ? events : [events];\n  eventList.forEach((event) => element.addEventListener(event, handler));\n\n  return () => {\n    eventList.forEach((event) => element.removeEventListener(event, handler));\n  };\n}\n\nexport function getTouchPointsDistance(touches: TouchList): number {\n  const touch0 = touches[0];\n  const touch1 = touches[1];\n  return Math.sqrt(\n      Math.pow(touch1.pageX - touch0.pageX, 2) +\n      Math.pow(touch1.pageY - touch0.pageY, 2),\n  );\n}\n","import { noop } from './util';\n\nclass Slider {\n   private onStart: any;\n   private onMove: any;\n   private onEnd: any;\n   private isSliderEnabled: any;\n   private container: any;\n   private touchMoveEvent: string | undefined;\n   private touchEndEvent: string |undefined;\n   private sx!: number;\n   private sy!: number;\n  constructor (container: any, {\n    onStart, onMove, onEnd, isSliderEnabled,\n  }: {\n    onStart?:(x: any, y: { x: number; y: number }) => void;\n    onMove?: (x: any, y: { dx: number; dy: number; mx: number; my: number }) => void;\n    onEnd?: () => void;\n    isSliderEnabled?: any;\n  }) {\n    this.container = container;\n    this.isSliderEnabled = isSliderEnabled;\n    this.onStart = onStart || noop;\n    this.onMove = onMove || noop;\n    this.onEnd = onEnd || noop;\n  }\n\n  startHandler = (eStart: Event) => {\n    if (!this.isSliderEnabled()) return;\n\n    this.removeListeners();\n\n    eStart.preventDefault();\n\n    const { moveHandler, endHandler, onStart } = this;\n\n    const isTouchEvent = eStart.type === 'touchstart' || eStart.type === 'touchend';\n\n    let sx: number;\n    let sy: number;\n    if (isTouchEvent) {\n      const touchEvent = eStart as TouchEvent; // Cast to TouchEvent type\n      this.touchMoveEvent = 'touchmove';\n      this.touchEndEvent = 'touchend';\n      sx = touchEvent.touches[0].clientX;\n      sy = touchEvent.touches[0].clientY;\n    } else {\n      const mouseEvent = eStart as MouseEvent; // Cast to MouseEvent type\n      this.touchMoveEvent = 'mousemove';\n      this.touchEndEvent = 'mouseup';\n      sx = mouseEvent.clientX;\n      sy = mouseEvent.clientY;\n    }\n    this.sx = sx;\n    this.sy = sy;\n\n    onStart(eStart, {\n      x: this.sx,\n      y: this.sy,\n    });\n\n    // add listeners\n    document.addEventListener(this.touchMoveEvent, moveHandler);\n    document.addEventListener(this.touchEndEvent, endHandler);\n    /*\n      add end handler in context menu as well.\n      As mouseup event is not trigger on context menu open\n      https://bugs.chromium.org/p/chromium/issues/detail?id=506801\n    */\n    document.addEventListener('contextmenu', endHandler);\n  };\n\n  moveHandler = (eMove: Event) => {\n    if (!this.isSliderEnabled()) return;\n\n    eMove.preventDefault();\n    const { sx, sy, onMove } = this;\n\n    const isTouchEvent = this.touchMoveEvent === 'touchmove';\n\n    // get the coordinates\n    let mx:number;\n    let my:number;\n    if (isTouchEvent) {\n      const touchEvent = eMove as TouchEvent; // Cast to TouchEvent type\n      mx = touchEvent.touches[0].clientX;\n      my = touchEvent.touches[0].clientY;\n    } else {\n      const mouseEvent = eMove as MouseEvent; // Cast to MouseEvent type\n      mx = mouseEvent.clientX;\n      my = mouseEvent.clientY;\n    }\n\n\n    onMove(eMove, {\n      dx: mx - sx,\n      dy: my - sy,\n      mx,\n      my,\n    });\n  };\n\n  endHandler = () => {\n    if (!this.isSliderEnabled()) return;\n    this.removeListeners();\n    this.onEnd();\n  };\n\n  // remove previous events if it's not removed\n  // - Case when while sliding mouse moved out of document and released there\n  removeListeners () {\n    if (this.touchMoveEvent) document.removeEventListener(this.touchMoveEvent, this.moveHandler);\n    if (this.touchEndEvent) document.removeEventListener(this.touchEndEvent, this.endHandler);\n    document.removeEventListener('contextmenu', this.endHandler);\n  }\n\n  init () {\n    ['touchstart', 'mousedown'].forEach((evt) => {\n      this.container.addEventListener(evt, this.startHandler);\n    });\n  }\n\n  destroy () {\n    ['touchstart', 'mousedown'].forEach((evt) => {\n      this.container.removeEventListener(evt, this.startHandler);\n    });\n    this.removeListeners();\n  }\n}\n\nexport default Slider;\n","\nimport {\n  createElement,\n  addClass,\n  removeClass,\n  css,\n  removeCss,\n  wrap,\n  unwrap,\n  remove,\n  easeOutQuart,\n  imageLoaded,\n  clamp,\n  assignEvent,\n  getTouchPointsDistance,\n  ZOOM_CONSTANT,\n  MOUSE_WHEEL_COUNT,\n} from './util';\n\nimport Slider from './Slider';\nimport FullScreenViewer from \"./FullScreen\";\n\nclass ImageViewer {\n  protected _elements: any;\n  private _options: {\n    zoomStep?: number;\n    zoomOnMouseWheel?: boolean ;\n    refreshOnResize?: any;\n    snapView: boolean;\n    zoomValue: any;\n    maxZoom: number;\n    hasZoomButtons: any;\n    listeners: any;\n  };\n  private _listeners: any;\n  protected _events: {\n    pinchStart?: () => void;\n    zoomOutClick?: () => void;\n    zoomInClick?: () => void;\n    mouseLeaveSnapView?: () => void;\n    mouseEnterSnapView?: () => void;\n    imageLoad?: () => void;\n    hiResImageLoad?: () => void;\n    snapViewOnMouseMove?: () => void;\n    onWindowResize?: () => void;\n    onCloseBtnClick?: () => void;\n    pinchMove?: () => void;\n    pinchEnd?: () => void;\n  };\n  private _state: {\n    zoomSliderLength?: number;\n    snapHandleDim?: { w: number; h: number };\n    zooming?: boolean;\n    snapViewVisible?: boolean;\n    zoomValue?: any\n    loaded?:any\n    imageDim?:any\n    containerDim?:any\n    snapImageDim?:any\n  };\n\n  private _sliders: {\n    snapSlider?: any;\n    imageSlider?: any;\n    zoomSlider?: any;\n  };\n  private _frames: {\n    slideMomentumCheck?: NodeJS.Timer;\n    zoomFrame?: number;\n    snapViewTimeout?: NodeJS.Timeout;\n    sliderMomentumFrame?: number;\n  };\n  private _images: { hiResImageSrc: any; imageSrc: any };\n  static defaults: any;\n  static FullScreenViewer: typeof FullScreenViewer;\n  _ev: any;\n\n  get zoomInButton () {\n    return this._options.hasZoomButtons ? `<div class=\"iv-button-zoom--in\" role=\"button\"></div>` : '';\n  }\n\n  get zoomOutButton () {\n    return this._options.hasZoomButtons ? `<div class=\"iv-button-zoom--out\" role=\"button\"></div>` : '';\n  }\n\n  get imageViewHtml () {\n    return `\n    <div class=\"iv-loader\"></div>\n    <div class=\"iv-snap-view\">\n      <div class=\"iv-snap-image-wrap\">\n        <div class=\"iv-snap-handle\"></div>\n      </div>\n      <div class=\"iv-zoom-actions ${this._options.hasZoomButtons ? 'iv-zoom-actions--has-buttons' : ''}\">\n        ${this.zoomInButton}\n        <div class=\"iv-zoom-slider\">\n          <div class=\"iv-zoom-handle\"></div>\n        </div>\n        ${this.zoomOutButton}\n      </div>\n    </div>\n    <div class=\"iv-image-view\" >\n      <div class=\"iv-image-wrap\" ></div>\n    </div>\n  `;\n  }\n\n  constructor (element: any, options = {}) {\n    const { container, domElement, imageSrc, hiResImageSrc } = this._findContainerAndImageSrc(element);\n\n    // containers for elements\n    this._elements = {\n      container,\n      domElement,\n    };\n\n    this._options = { ...ImageViewer.defaults, ...options };\n\n    // container for all events\n    this._events = {};\n\n    this._listeners = this._options.listeners || {};\n\n    // container for all timeout and frames\n    this._frames = {};\n\n    // container for all sliders\n    this._sliders = {};\n\n    // maintain current state\n    this._state = {\n      zoomValue: this._options.zoomValue,\n    };\n\n    this._images = {\n      imageSrc,\n      hiResImageSrc,\n    };\n\n    this._init();\n\n    if (imageSrc) {\n      this._loadImages();\n    }\n\n    // store reference of imageViewer in domElement\n    domElement._imageViewer = this;\n  }\n\n  _findContainerAndImageSrc(element: any) {\n    let domElement = element;\n    let imageSrc, hiResImageSrc;\n\n    if (typeof element === 'string') {\n      domElement = document.querySelector(element) as HTMLElement;\n    }\n\n    // throw error if imageViewer is already assigned\n    if (domElement._imageViewer) {\n      throw new Error('An image viewer is already being initiated on the element.');\n    }\n\n    let container = element;\n\n    if (domElement.tagName === 'IMG') {\n      imageSrc = domElement.src;\n      hiResImageSrc = domElement.getAttribute('high-res-src') || domElement.getAttribute('data-high-res-src');\n\n      // wrap the image with iv-container div\n      container = wrap(domElement, { className: 'iv-container iv-image-mode', style: { display: 'inline-block', overflow: 'hidden' } });\n\n      // hide the image and add iv-original-img class\n      css(domElement, {\n        opacity: 0,\n        position: 'relative',\n        zIndex: -1,\n      });\n    } else {\n      imageSrc = domElement.getAttribute('src') || domElement.getAttribute('data-src');\n      hiResImageSrc = domElement.getAttribute('high-res-src') || domElement.getAttribute('data-high-res-src');\n    }\n\n    return {\n      container,\n      domElement,\n      imageSrc,\n      hiResImageSrc,\n    };\n  }\n\n  _init () {\n    // initialize the dom elements\n    this._initDom();\n\n    // initialize slider\n    this._initImageSlider();\n    this._initSnapSlider();\n    this._initZoomSlider();\n\n    // enable pinch and zoom feature for touch screens\n    this._pinchAndZoom();\n\n    // enable scroll zoom interaction\n    this._scrollZoom();\n\n    // enable double tap to zoom interaction\n    this._doubleTapToZoom();\n\n    // initialize events\n    this._initEvents();\n  }\n\n  _initDom () {\n    const { container } = this._elements;\n\n    // add image-viewer layout elements\n    createElement({\n      tagName: 'div',\n      className: 'iv-wrap',\n      html: this.imageViewHtml,\n      parent: container,\n    });\n\n    // add container class on the container\n    addClass(container, 'iv-container');\n\n    // if the element is static position, position it relatively\n    if (css(container, 'position') === 'static') {\n      css(container, { position: 'relative' });\n    }\n\n    // save references for later use\n    this._elements = {\n      ...this._elements,\n      snapView: container.querySelector('.iv-snap-view'),\n      snapImageWrap: container.querySelector('.iv-snap-image-wrap'),\n      imageWrap: container.querySelector('.iv-image-wrap'),\n      snapHandle: container.querySelector('.iv-snap-handle'),\n      zoomHandle: container.querySelector('.iv-zoom-handle'),\n      zoomIn: container.querySelector('.iv-button-zoom--in'),\n      zoomOut: container.querySelector('.iv-button-zoom--out'),\n    };\n\n    if (this._listeners.onInit) {\n      this._listeners.onInit(this._callbackData);\n    }\n  }\n\n  _initImageSlider () {\n    const {\n      _elements,\n    } = this;\n\n    const { imageWrap } = _elements;\n\n    let positions:any, currentPos:any;\n\n    /* Add slide interaction to image */\n    const imageSlider = new Slider(imageWrap, {\n      isSliderEnabled: () => {\n        const { loaded, zooming, zoomValue } = this._state;\n        return loaded && !zooming && zoomValue > 100;\n      },\n      onStart: (_, position) => {\n        const { snapSlider } = this._sliders;\n\n        // clear all animation frame and interval\n        this._clearFrames();\n\n        snapSlider.onStart();\n\n        // reset positions\n        positions = [position, position];\n        currentPos = undefined;\n\n        this._frames.slideMomentumCheck = setInterval(() => {\n          if (!currentPos) return;\n\n          positions.shift();\n          positions.push({\n            x: currentPos.mx,\n            y: currentPos.my,\n          });\n        }, 50);\n      },\n      onMove: (e, position) => {\n        const { snapImageDim } = this._state;\n        const { snapSlider } = this._sliders;\n        const imageCurrentDim = this._getImageCurrentDim();\n        currentPos = position;\n\n        snapSlider.onMove(e, {\n          dx: -position.dx * snapImageDim.w / imageCurrentDim.w,\n          dy: -position.dy * snapImageDim.h / imageCurrentDim.h,\n        });\n      },\n      onEnd: () => {\n        const { snapImageDim } = this._state;\n        const { snapSlider } = this._sliders;\n        const imageCurrentDim = this._getImageCurrentDim();\n\n        // clear all animation frame and interval\n        this._clearFrames();\n\n        let step:number, positionX:number, positionY:number;\n\n        const xDiff = positions[1].x - positions[0].x;\n        const yDiff = positions[1].y - positions[0].y;\n\n        const momentum = () => {\n          if (step <= 60) {\n            this._frames.sliderMomentumFrame = requestAnimationFrame(momentum);\n          }\n\n          positionX += easeOutQuart(step, xDiff / 3, -xDiff / 3, 60);\n          positionY += easeOutQuart(step, yDiff / 3, -yDiff / 3, 60);\n\n          snapSlider.onMove(null, {\n            dx: -(positionX * snapImageDim.w / imageCurrentDim.w),\n            dy: -(positionY * snapImageDim.h / imageCurrentDim.h),\n          });\n\n          step++;\n        };\n\n        if (Math.abs(xDiff) > 30 || Math.abs(yDiff) > 30) {\n          step = 1;\n          positionX = currentPos.dx;\n          positionY = currentPos.dy;\n\n          momentum();\n        }\n      },\n    });\n\n    imageSlider.init();\n\n    this._sliders.imageSlider = imageSlider;\n  }\n\n  _initSnapSlider () {\n    const {\n      snapHandle,\n    } = this._elements;\n\n    let startHandleTop:any, startHandleLeft:any;\n\n    const snapSlider = new Slider(snapHandle, {\n      isSliderEnabled: () => {\n        return this._state.loaded;\n      },\n      onStart: () => {\n        const { slideMomentumCheck, sliderMomentumFrame } = this._frames;\n\n        startHandleTop = parseFloat(<string>css(snapHandle, 'top'));\n        startHandleLeft = parseFloat(<string>css(snapHandle, 'left'));\n\n        // stop momentum on image\n        clearInterval(slideMomentumCheck);\n        if (typeof sliderMomentumFrame === \"number\") {\n          cancelAnimationFrame(sliderMomentumFrame);\n        }\n      },\n      onMove: (_, position) => {\n        const { snapHandleDim, snapImageDim } = this._state;\n        const { image } = this._elements;\n\n        const imageCurrentDim = this._getImageCurrentDim();\n\n        if (!snapHandleDim) return;\n        // find handle left and top and make sure they lay between the snap image\n        const maxLeft = Math.max(snapImageDim.w - snapHandleDim.w, startHandleLeft);\n        const maxTop = Math.max(snapImageDim.h - snapHandleDim.h, startHandleTop);\n        const minLeft = Math.min(0, startHandleLeft);\n        const minTop = Math.min(0, startHandleTop);\n\n        const left = clamp(startHandleLeft + position.dx, minLeft, maxLeft);\n        const top = clamp(startHandleTop + position.dy, minTop, maxTop);\n\n        const imgLeft = -left * imageCurrentDim.w / snapImageDim.w;\n        const imgTop = -top * imageCurrentDim.h / snapImageDim.h;\n\n        css(snapHandle, {\n          left: `${left}px`,\n          top: `${top}px`,\n        });\n\n        css(image, {\n          left: `${imgLeft}px`,\n          top: `${imgTop}px`,\n        });\n      },\n    });\n\n    snapSlider.init();\n\n    this._sliders.snapSlider = snapSlider;\n  }\n\n  _initZoomSlider () {\n    const { snapView, zoomHandle } = this._elements;\n\n    // zoom in zoom out using zoom handle\n    const sliderElm = snapView.querySelector('.iv-zoom-slider');\n\n    let leftOffset:number, handleWidth:number;\n\n    // on zoom slider we have to follow the mouse and set the handle to its position.\n    const zoomSlider = new Slider(sliderElm, {\n      isSliderEnabled: () => {\n        return this._state.loaded;\n      },\n      onStart: (eStart) => {\n        const { zoomSlider: slider } = this._sliders;\n\n        leftOffset = sliderElm.getBoundingClientRect().left + document.body.scrollLeft;\n        handleWidth = parseInt(<string>css(zoomHandle, 'width'), 10);\n\n        // move the handle to current mouse position\n        slider.onMove(eStart);\n      },\n      onMove: (e) => {\n        const { maxZoom } = this._options;\n        const { zoomSliderLength } = this._state;\n\n        const pageX = e.pageX !== undefined ? e.pageX : e.touches[0].pageX;\n\n        if (!zoomSliderLength) return;\n        const newLeft = clamp(pageX - leftOffset - handleWidth / 2, 0, zoomSliderLength);\n        const zoomValue = 100 + ((maxZoom - 100) * newLeft / zoomSliderLength);\n\n        this.zoom(zoomValue);\n      },\n    });\n\n    zoomSlider.init();\n    this._sliders.zoomSlider = zoomSlider;\n  }\n\n  _initEvents () {\n    this._snapViewEvents();\n\n    // handle window resize\n    if (this._options.refreshOnResize) {\n      this._events.onWindowResize = assignEvent(window  as any as HTMLElement, 'resize', this.refresh);\n    }\n  }\n\n  _snapViewEvents () {\n    const { imageWrap, snapView } = this._elements;\n\n    // show snapView on mouse move\n    this._events.snapViewOnMouseMove = assignEvent(imageWrap, ['touchmove', 'mousemove'], () => {\n      this.showSnapView();\n    });\n\n    // keep showing snapView if on hover over it without any timeout\n    this._events.mouseEnterSnapView = assignEvent(snapView, ['mouseenter', 'touchstart'], () => {\n      this._state.snapViewVisible = false;\n      this.showSnapView(true);\n    });\n\n    // on mouse leave set timeout to hide snapView\n    this._events.mouseLeaveSnapView = assignEvent(snapView, ['mouseleave', 'touchend'], () => {\n      this._state.snapViewVisible = false;\n      this.showSnapView();\n    });\n\n    if (!this._options.hasZoomButtons) {\n      return;\n    }\n    const { zoomOut, zoomIn } = this._elements;\n\n    this._events.zoomInClick = assignEvent(zoomIn, ['click'], () => {\n      this.zoom(this._state.zoomValue + (this._options.zoomStep || 50));\n    });\n\n    this._events.zoomOutClick = assignEvent(zoomOut, ['click'], () => {\n      this.zoom(this._state.zoomValue - (this._options.zoomStep || 50));\n    });\n  }\n\n  _pinchAndZoom () {\n    const { imageWrap, container } = this._elements;\n\n    // apply pinch and zoom feature\n    const onPinchStart = (eStart: TouchEvent) => {\n      const { loaded, zoomValue: startZoomValue } = this._state;\n      const { _events: events } = this;\n\n      if (!loaded) return;\n\n      const touch0 = eStart.touches[0];\n      const touch1 = eStart.touches[1];\n\n      if (!(touch0 && touch1)) {\n        return;\n      }\n\n      this._state.zooming = true;\n\n      const contOffset = container.getBoundingClientRect();\n\n      // find distance between two touch points\n      const startDist = getTouchPointsDistance(eStart.touches);\n\n      // find the center for the zoom\n      const center = {\n        x: (touch1.pageX + touch0.pageX) / 2 - (contOffset.left + document.body.scrollLeft),\n        y: (touch1.pageY + touch0.pageY) / 2 - (contOffset.top + document.body.scrollTop),\n      };\n\n      const moveListener = (eMove: TouchEvent) => {\n        // eMove.preventDefault();\n\n        const newDist = getTouchPointsDistance(eMove.touches);\n\n        const zoomValue = startZoomValue + (newDist - startDist) / 2;\n\n        this.zoom(zoomValue, center);\n      };\n\n      const endListener = (eEnd: TouchEvent) => {\n        // unbind events\n        if (events.pinchMove) events.pinchMove();\n        if (events.pinchEnd) events.pinchEnd();\n        this._state.zooming = false;\n        // properly resume move event if one finger remains\n        if (eEnd.touches.length === 1) {\n          this._sliders.imageSlider.startHandler(eEnd);\n        }\n      };\n\n      // remove events if already assigned\n      if (events.pinchMove) events.pinchMove();\n      if (events.pinchEnd) events.pinchEnd();\n\n      // assign events\n      events.pinchMove = assignEvent(document as any as HTMLElement, 'touchmove', moveListener);\n      events.pinchEnd = assignEvent(document as any as HTMLElement, 'touchend', endListener);\n    };\n\n    this._events.pinchStart = assignEvent(imageWrap, 'touchstart', onPinchStart);\n  }\n\n  _scrollZoom () {\n    /* Add zoom interaction in mouse wheel */\n    const { _options } = this;\n    const { container, imageWrap } = this._elements;\n\n    let changedDelta = 0;\n\n    const onMouseWheel = (e: WheelEvent) => {\n      const { loaded, zoomValue } = this._state;\n\n      if (!_options.zoomOnMouseWheel || !loaded) return;\n\n      // clear all animation frame and interval\n      this._clearFrames();\n\n      // cross-browser wheel delta\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      const delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail || -e.deltaY));\n\n      const newZoomValue = zoomValue * (100 + delta * ZOOM_CONSTANT) / 100;\n\n      if (!(newZoomValue >= 100 && newZoomValue <= _options.maxZoom)) {\n        changedDelta += Math.abs(delta);\n      } else {\n        changedDelta = 0;\n      }\n\n      e.preventDefault();\n\n      if (changedDelta > MOUSE_WHEEL_COUNT) return;\n\n      const contOffset = container.getBoundingClientRect();\n\n      const x = (e.pageX || e.pageX) - (contOffset.left + document.body.scrollLeft);\n      const y = (e.pageY || e.pageY) - (contOffset.top + document.body.scrollTop);\n\n      this.zoom(newZoomValue, {\n        x,\n        y,\n      });\n\n      // show the snap viewer\n      this.showSnapView();\n    };\n\n    this._ev = assignEvent(imageWrap, 'wheel', onMouseWheel);\n  }\n\n  _doubleTapToZoom () {\n    const { imageWrap } = this._elements;\n    // handle double tap for zoom in and zoom out\n\n    let touchTime = 0;\n\n    let point: {x: number, y:number};\n\n    const onDoubleTap = (e: MouseEvent) => {\n      if (touchTime === 0) {\n        touchTime = Date.now();\n        point = {\n          x: e.pageX,\n          y: e.pageY,\n        };\n      } else if (Date.now() - touchTime < 500 && Math.abs(e.pageX - point.x) < 50 && Math.abs(e.pageY - point.y) < 50) {\n        if (this._state.zoomValue === this._options.zoomValue) {\n          this.zoom(200);\n        } else {\n          this.resetZoom();\n        }\n        touchTime = 0;\n      } else {\n        touchTime = 0;\n      }\n    };\n\n    assignEvent(imageWrap, 'click', onDoubleTap);\n  }\n\n  _getImageCurrentDim () {\n    const { zoomValue, imageDim } = this._state;\n    return {\n      w: imageDim.w * (zoomValue / 100),\n      h: imageDim.h * (zoomValue / 100),\n    };\n  }\n\n  _loadImages () {\n    const { _images, _elements } = this;\n    const { imageSrc, hiResImageSrc } = _images;\n    const { container, snapImageWrap, imageWrap } = _elements;\n\n    const ivLoader = container.querySelector('.iv-loader');\n\n    // remove old images\n    remove(container.querySelectorAll('.iv-snap-image, .iv-image'));\n\n    // add snapView image\n    const snapImage = createElement({\n      tagName: 'img',\n      className: 'iv-snap-image',\n      src: imageSrc,\n      insertBefore: snapImageWrap.firstChild,\n      parent: snapImageWrap,\n    });\n\n    // add image\n    const image = createElement({\n      tagName: 'img',\n      className: 'iv-image iv-small-image',\n      src: imageSrc,\n      parent: imageWrap,\n    });\n\n    this._state.loaded = false;\n\n    // store image reference in _elements\n    this._elements.image = image;\n    this._elements.snapImage = snapImage;\n\n    css(ivLoader, { display: 'block' });\n\n    // keep visibility hidden until image is loaded\n    css(image, { visibility: 'hidden' });\n\n    // hide snap view if open\n    this.hideSnapView();\n\n    const onImageLoad = () => {\n      // hide the iv loader\n      css(ivLoader, { display: 'none' });\n\n      // show the image\n      css(image, { visibility: 'visible' });\n\n      // load high resolution image if provided\n      if (hiResImageSrc) {\n        this._loadHighResImage(hiResImageSrc);\n      }\n\n      // set loaded flag to true\n      this._state.loaded = true;\n\n      // calculate the dimension\n      this._calculateDimensions();\n\n      // dispatch image load event\n      if (this._listeners.onImageLoad) {\n        this._listeners.onImageLoaded(this._callbackData);\n      }\n\n      // reset the zoom\n      this.resetZoom();\n    };\n\n    if (imageLoaded(image)) {\n      onImageLoad();\n    } else {\n      this._events.imageLoad = assignEvent(image, 'load', onImageLoad);\n    }\n  }\n\n  _loadHighResImage (hiResImageSrc:string) {\n    const { imageWrap, container } = this._elements;\n\n    const lowResImg = this._elements.image;\n\n    const hiResImage = createElement({\n      tagName: 'img',\n      className: 'iv-image iv-large-image',\n      src: hiResImageSrc,\n      parent: imageWrap,\n      style: lowResImg.style.cssText,\n    });\n\n    // add all the style attributes from lowResImg to highResImg\n    hiResImage.style.cssText = lowResImg.style.cssText;\n\n    this._elements.image = container.querySelectorAll('.iv-image');\n\n    const onHighResImageLoad = () => {\n      // remove the low size image and set this image as default image\n      remove(lowResImg);\n      this._elements.image = hiResImage;\n      // this._calculateDimensions();\n    };\n\n    if (imageLoaded(hiResImage)) {\n      onHighResImageLoad();\n    } else {\n      this._events.hiResImageLoad = assignEvent(hiResImage, 'load', onHighResImageLoad);\n    }\n  }\n\n  _calculateDimensions () {\n    const { image, container, snapView, snapImage, zoomHandle } = this._elements;\n\n    // calculate content width of image and snap image\n    const imageWidth = parseInt(<string>css(image, 'width'), 10);\n    const imageHeight = parseInt(<string>css(image, 'height'), 10);\n\n    const contWidth = parseInt(<string>css(container, 'width'), 10);\n    const contHeight = parseInt(<string>css(container, 'height'), 10);\n\n    const snapViewWidth = snapView.clientWidth;\n    const snapViewHeight = snapView.clientHeight;\n\n    // set the container dimension\n    this._state.containerDim = {\n      w: contWidth,\n      h: contHeight,\n    };\n\n    const ratio = imageWidth / imageHeight;\n\n    // set the image dimension\n    const imgWidth = (imageWidth > imageHeight && contHeight >= contWidth) || ratio * contHeight > contWidth\n      ? contWidth\n      : ratio * contHeight;\n\n    const imgHeight = imgWidth / ratio;\n\n    this._state.imageDim = {\n      w: imgWidth,\n      h: imgHeight,\n    };\n\n    // reset image position and zoom\n    css(image, {\n      width: `${imgWidth}px`,\n      height: `${imgHeight}px`,\n      left: `${(contWidth - imgWidth) / 2}px`,\n      top: `${(contHeight - imgHeight) / 2}px`,\n      maxWidth: 'none',\n      maxHeight: 'none',\n    });\n\n    // set the snap Image dimension\n    const snapWidth = imgWidth > imgHeight ? snapViewWidth : imgWidth * snapViewHeight / imgHeight;\n    const snapHeight = imgHeight > imgWidth ? snapViewHeight : imgHeight * snapViewWidth / imgWidth;\n\n    this._state.snapImageDim = {\n      w: snapWidth,\n      h: snapHeight,\n    };\n\n    css(snapImage, {\n      width: `${snapWidth}px`,\n      height: `${snapHeight}px`,\n    });\n\n    const zoomSlider = snapView.querySelector('.iv-zoom-slider').clientWidth;\n    // calculate zoom slider area\n    this._state.zoomSliderLength = zoomSlider - zoomHandle.offsetWidth;\n  }\n\n  resetZoom (animate = true) {\n    const { zoomValue } = this._options;\n\n    if (!animate) {\n      this._state.zoomValue = zoomValue;\n    }\n\n    this.zoom(zoomValue);\n  }\n\n  zoom = (perc: number, point?: any) => {\n    const { _options, _elements, _state } = this;\n    const { zoomValue: curPerc, imageDim, containerDim, zoomSliderLength } = _state;\n    const { image, zoomHandle } = _elements;\n    const { maxZoom } = _options;\n\n    perc = Math.round(Math.max(100, perc));\n    perc = Math.min(maxZoom, perc);\n\n    point = point || {\n      x: containerDim.w / 2,\n      y: containerDim.h / 2,\n    };\n\n    const curLeft = parseFloat(<string>css(image, 'left'));\n    const curTop = parseFloat(<string>css(image, 'top'));\n\n    // clear any panning frames\n    this._clearFrames();\n\n    let step = 0;\n\n    const baseLeft = (containerDim.w - imageDim.w) / 2;\n    const baseTop = (containerDim.h - imageDim.h) / 2;\n    const baseRight = containerDim.w - baseLeft;\n    const baseBottom = containerDim.h - baseTop;\n\n    const zoom = () => {\n      step++;\n\n      if (step < 16) {\n        this._frames.zoomFrame = requestAnimationFrame(zoom);\n      }\n\n      const tickZoom = easeOutQuart(step, curPerc, perc - curPerc, 16);\n      const ratio = tickZoom / curPerc;\n\n      const imgWidth = imageDim.w * tickZoom / 100;\n      const imgHeight = imageDim.h * tickZoom / 100;\n\n      let newLeft = -((point.x - curLeft) * ratio - point.x);\n      let newTop = -((point.y - curTop) * ratio - point.y);\n\n      // fix for left and top\n      newLeft = Math.min(newLeft, baseLeft);\n      newTop = Math.min(newTop, baseTop);\n\n      // fix for right and bottom\n      if (newLeft + imgWidth < baseRight) {\n        newLeft = baseRight - imgWidth; // newLeft - (newLeft + imgWidth - baseRight)\n      }\n\n      if (newTop + imgHeight < baseBottom) {\n        newTop = baseBottom - imgHeight; // newTop + (newTop + imgHeight - baseBottom)\n      }\n\n      css(image, {\n        height: `${imgHeight}px`,\n        width: `${imgWidth}px`,\n        left: `${newLeft}px`,\n        top: `${newTop}px`,\n      });\n\n      this._state.zoomValue = tickZoom;\n\n      this._resizeSnapHandle(imgWidth, imgHeight, newLeft, newTop);\n\n      // update zoom handle position\n      css(zoomHandle, {\n        left: `${(tickZoom - 100) * (zoomSliderLength || 0) / (maxZoom - 100)}px`,\n      });\n\n      // dispatch zoom changed event\n      if (this._listeners.onZoomChange) {\n        this._listeners.onZoomChange(this._callbackData);\n      }\n    };\n\n    zoom();\n  };\n\n  _clearFrames = () => {\n    const { slideMomentumCheck, sliderMomentumFrame, zoomFrame } = this._frames;\n    clearInterval(slideMomentumCheck);\n    if (typeof sliderMomentumFrame === \"number\") {\n      cancelAnimationFrame(sliderMomentumFrame);\n    }\n    if (typeof zoomFrame === \"number\") {\n      cancelAnimationFrame(zoomFrame);\n    }\n  };\n\n  _resizeSnapHandle = (imgWidth:number, imgHeight:number, imgLeft:number, imgTop:number) => {\n    const { _elements, _state } = this;\n    const { snapHandle, image } = _elements;\n    const { imageDim, containerDim, zoomValue, snapImageDim } = _state;\n\n    const imageWidth = imgWidth || imageDim.w * zoomValue / 100;\n    const imageHeight = imgHeight || imageDim.h * zoomValue / 100;\n    const imageLeft = imgLeft || parseFloat(<string>css(image, 'left'));\n    const imageTop = imgTop || parseFloat(<string>css(image, 'top'));\n\n    const left = -imageLeft * snapImageDim.w / imageWidth;\n    const top = -imageTop * snapImageDim.h / imageHeight;\n\n    const handleWidth = (containerDim.w * snapImageDim.w) / imageWidth;\n    const handleHeight = (containerDim.h * snapImageDim.h) / imageHeight;\n\n    css(snapHandle, {\n      top: `${top}px`,\n      left: `${left}px`,\n      width: `${handleWidth}px`,\n      height: `${handleHeight}px`,\n    });\n\n    this._state.snapHandleDim = {\n      w: handleWidth,\n      h: handleHeight,\n    };\n  };\n\n  showSnapView = (noTimeout?: boolean) => {\n    const { snapViewVisible, zoomValue, loaded } = this._state;\n    const { snapView } = this._elements;\n\n    if (!this._options.snapView) return;\n\n    if (snapViewVisible || zoomValue <= 100 || !loaded) return;\n\n    clearTimeout(this._frames.snapViewTimeout);\n\n    this._state.snapViewVisible = true;\n\n    css(snapView, { opacity: 1, pointerEvents: 'inherit' });\n\n    if (!noTimeout) {\n      this._frames.snapViewTimeout = setTimeout(this.hideSnapView, 1500);\n    }\n  };\n\n  hideSnapView = () => {\n    const { snapView } = this._elements;\n    css(snapView, { opacity: 0, pointerEvents: 'none' });\n    this._state.snapViewVisible = false;\n  };\n\n  refresh = () => {\n    this._calculateDimensions();\n    this.resetZoom();\n  };\n\n  load (imageSrc :string, hiResImageSrc: string) {\n    this._images = {\n      imageSrc,\n      hiResImageSrc,\n    };\n\n    this._loadImages();\n  }\n\n  destroy () {\n    const { container, domElement } = this._elements;\n    // destroy all the sliders\n    Object.entries(this._sliders).forEach(([, slider]: [string, Slider]) => {\n      slider.destroy();\n    });\n\n    // unbind all events\n    Object.entries(this._events).forEach(([, unbindEvent]: [string, () => void]) => {\n      unbindEvent();\n    });\n\n    // clear all the frames\n    this._clearFrames();\n\n    // remove html from the container\n    remove(container.querySelector('.iv-wrap'));\n\n    // remove iv-container class from container\n    removeClass(container, 'iv-container');\n\n    // remove added style from container\n    removeCss(document.querySelector('html') as HTMLElement, 'relative');\n\n    // if container has original image, unwrap the image and remove the class\n    // which will happen when domElement is not the container\n    if (domElement !== container) {\n      unwrap(domElement);\n    }\n\n    // remove imageViewer reference from dom element\n    domElement._imageViewer = null;\n\n    if (this._listeners.onDestroy) {\n      this._listeners.onDestroy();\n    }\n  }\n\n  /**\n   * Data will be passed to the callback registered with each new instance\n   */\n  get _callbackData (): {\n    container: HTMLElement;\n    snapView: HTMLElement;\n    zoomValue: number;\n    reachedMin: boolean;\n    reachedMax: boolean;\n    instance: ImageViewer;\n  } {\n    return {\n      container: this._elements.container,\n      snapView: this._elements.snapView,\n      zoomValue: this._state.zoomValue,\n      reachedMin: Math.round(this._state.zoomValue) === this._options.zoomValue,\n      reachedMax: Math.round(this._state.zoomValue) === this._options.maxZoom,\n      instance: this,\n    };\n  }\n}\n\nImageViewer.defaults = {\n  zoomValue: 100,\n  snapView: true,\n  maxZoom: 500,\n  refreshOnResize: true,\n  zoomOnMouseWheel: true,\n  hasZoomButtons: false,\n  zoomStep: 50,\n  listeners: {\n    onInit: null,\n    onDestroy: null,\n    onImageLoaded: null,\n    onZoomChange: null,\n  },\n};\n\nexport default ImageViewer;\n","import { createElement, assignEvent, css, remove, removeCss } from './util';\nimport ImageViewer from './ImageViewer';\n\nconst fullScreenHtml = `\n  <div class=\"iv-fullscreen-container\"></div>\n  <div class=\"iv-fullscreen-close\"></div>\n`;\n\nclass FullScreenViewer extends ImageViewer {\n  constructor (options = {}) {\n    const fullScreenElem = createElement({\n      tagName: 'div',\n      className: 'iv-fullscreen',\n      html: fullScreenHtml,\n      parent: document.body,\n    });\n\n    const container = fullScreenElem.querySelector('.iv-fullscreen-container');\n\n    // call the ImageViewer constructor\n    super(container, { ...options, refreshOnResize: false });\n\n    // add fullScreenElem on element list\n    this._elements.fullScreen = fullScreenElem;\n\n    this._initFullScreenEvents();\n  }\n  _initFullScreenEvents () {\n    const { fullScreen } = this._elements;\n    const closeBtn = fullScreen.querySelector('.iv-fullscreen-close') as HTMLElement;\n\n    // add close button event\n    this._events.onCloseBtnClick = assignEvent(closeBtn, 'click', this.hide);\n  }\n  show (imageSrc : string, hiResImageSrc: string) {\n    // show the element\n    css(this._elements.fullScreen, { display: 'block' });\n\n    // if image source is provide load image source\n    if (imageSrc) {\n      this.load(imageSrc, hiResImageSrc);\n    }\n\n    // handle window resize\n    this._events.onWindowResize = assignEvent(window  as any as HTMLElement, 'resize', this.refresh);\n\n    // disable scroll on html\n    css(document.querySelector('html') as HTMLElement, { overflow: 'hidden' });\n  }\n  hide = () => {\n    // hide the fullscreen\n    css(this._elements.fullScreen, { display: 'none' });\n\n    // enable scroll\n    removeCss(document.querySelector('html') as HTMLElement, 'overflow');\n\n    // remove window event\n    if (this._events.onWindowResize) this._events.onWindowResize();\n  };\n  destroy () {\n    const { fullScreen } = this._elements;\n\n    // destroy image viewer\n    super.destroy();\n\n    // remove the element\n    remove(fullScreen);\n  }\n}\n\nexport default FullScreenViewer;\n"],"names":["noop","easeOutQuart","currentTime","startValue","changedValue","duration","createElement","options","elem","addClass","el","className","classNameAry","classItem","removeClass","imageLoaded","img","toArray","list","css","elements","properties","elmArray","element","key","removeCss","property","wrap","tag","id","style","wrapper","parentNode","unwrap","parent","remove","clamp","num","min","max","assignEvent","events","handler","eventList","event","getTouchPointsDistance","touches","touch0","touch1","Slider","container","onStart","onMove","onEnd","isSliderEnabled","eStart","moveHandler","endHandler","isTouchEvent","sx","sy","touchEvent","mouseEvent","eMove","mx","my","evt","ImageViewer","domElement","imageSrc","hiResImageSrc","_elements","imageWrap","positions","currentPos","imageSlider","loaded","zooming","zoomValue","_","position","snapSlider","e","snapImageDim","imageCurrentDim","step","positionX","positionY","xDiff","yDiff","momentum","snapHandle","startHandleTop","startHandleLeft","slideMomentumCheck","sliderMomentumFrame","snapHandleDim","image","maxLeft","maxTop","minLeft","minTop","left","top","imgLeft","imgTop","snapView","zoomHandle","sliderElm","leftOffset","handleWidth","zoomSlider","slider","maxZoom","zoomSliderLength","pageX","newLeft","zoomOut","zoomIn","onPinchStart","startZoomValue","contOffset","startDist","center","moveListener","newDist","endListener","eEnd","_options","changedDelta","onMouseWheel","delta","newZoomValue","x","y","touchTime","point","imageDim","_images","snapImageWrap","ivLoader","snapImage","onImageLoad","lowResImg","hiResImage","onHighResImageLoad","imageWidth","imageHeight","contWidth","contHeight","snapViewWidth","snapViewHeight","ratio","imgWidth","imgHeight","snapWidth","snapHeight","animate","perc","_state","curPerc","containerDim","curLeft","curTop","baseLeft","baseTop","baseRight","baseBottom","zoom","tickZoom","newTop","zoomFrame","imageLeft","imageTop","handleHeight","noTimeout","snapViewVisible","unbindEvent","fullScreenHtml","FullScreenViewer","fullScreenElem","fullScreen","closeBtn"],"mappings":"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"}