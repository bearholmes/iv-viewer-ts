{"version":3,"file":"iv-viewer-ts.umd.js","sources":["../src/util.ts","../src/Slider.ts","../src/ImageViewer.ts","../src/FullScreen.ts"],"sourcesContent":["// constants\nexport const ZOOM_CONSTANT = 15; // increase or decrease value for zoom on mouse wheel\nexport const MOUSE_WHEEL_COUNT = 5; // A mouse delta after which it should stop preventing default behaviour of mouse wheel\n\nexport const noop = new Function();\n\n// ease out method\n/*\n    t : current time,\n    b : intial value,\n    c : changed value,\n    d : duration\n*/\nexport function easeOutQuart (\n  currentTime: number,\n  startValue: number,\n  changedValue: number,\n  duration: number,\n): number {\n  currentTime /= duration;\n  currentTime -= 1;\n  return (\n    -changedValue *\n      (currentTime * currentTime * currentTime * currentTime - 1) +\n      startValue\n  );\n}\n\ninterface CreateElementOptions {\n  tagName: string;\n  id?: string;\n  html?: string;\n  className?: string;\n  src?: string;\n  style?: string;\n  child?: Node;\n  parent: Node;\n  insertBefore?: Node;\n}\n\nexport function createElement (options: CreateElementOptions) {\n  const elem = document.createElement(options.tagName);\n  if (options.id) elem.id = options.id;\n  if (options.html) elem.innerHTML = options.html;\n  if (options.className) elem.className = options.className;\n  if (options.src && elem instanceof HTMLImageElement) {\n    const escapedSrc = encodeURIComponent(options.src);\n    elem.setAttribute('src', escapedSrc);\n  }\n  if (options.style) elem.style.cssText = options.style;\n  if (options.child) elem.appendChild(options.child);\n\n  // Insert before\n  if (options.insertBefore) {\n    options.parent.insertBefore(elem, options.insertBefore);\n\n  // Standard append\n  } else {\n    options.parent.appendChild(elem);\n  }\n\n  return elem;\n}\n\n// method to add class\nexport function addClass (el: HTMLElement, className: string): void {\n  const classNameAry = className.split(' ');\n\n  if (classNameAry.length > 1) {\n    classNameAry.forEach((classItem) => addClass(el, classItem));\n  } else if (el.classList) {\n    el.classList.add(className);\n  } else {\n    el.className += ` ${className}`;\n  }\n}\n\n// method to remove class\nexport function removeClass (el: HTMLElement, className: string): void {\n  const classNameAry = className.split(' ');\n\n  if (classNameAry.length > 1) {\n    classNameAry.forEach((classItem) => removeClass(el, classItem));\n  } else if (el.classList) {\n    el.classList.remove(className);\n  } else {\n    el.className = el.className.replace(\n      new RegExp(`(^|\\\\b)${className.split(' ').join('|')}(\\\\b|$)`, 'gi'),\n      ' ',\n    );\n  }\n}\n\n// function to check if image is loaded\nexport function imageLoaded (img: any): boolean {\n  return (\n    img.complete &&\n      (typeof img.naturalWidth === 'undefined' || img.naturalWidth !== 0)\n  );\n}\n\nexport function toArray(list: Node | NodeList | HTMLCollectionOf<HTMLElement>): (HTMLCollectionOf<Element> | Element)[] {\n  if (list instanceof HTMLElement) {\n    return [list];\n  } else if (list instanceof NodeList || list instanceof HTMLCollection) {\n    return Array.prototype.slice.call(list);\n  } else {\n    return [];\n  }\n}\n\n\n\n\ntype AnyObject = { [key: string]: any };\nexport function assign (target: AnyObject, ...rest: AnyObject[]): AnyObject {\n  rest.forEach((obj) => {\n    Object.keys(obj).forEach((key) => {\n      target[key] = obj[key];\n    });\n  });\n  return target;\n}\n\n//Node | NodeList | HTMLCollectionOf<HTMLElement>\nexport function css(elements: any, properties: any): string | undefined {\n  const elmArray = toArray(elements);\n\n  if (typeof properties === 'string') {\n    // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n    // @ts-ignore\n    return window.getComputedStyle(<Element>elmArray[0])[properties];\n  }\n\n  elmArray.forEach((element) => {\n    Object.keys(properties).forEach((key:any) => {\n      (element as HTMLElement).style[key] = properties[key];\n    });\n  });\n\n  return undefined;\n}\n\n\n\nexport function removeCss(element: HTMLElement, property: string): void {\n  element.style.removeProperty(property);\n}\n\nexport function wrap(element: HTMLElement, { tag = 'div', className, id, style }: { tag?: string, className?: string, id?: string, style?: { display?: string, overflow?: string } }): HTMLElement {\n  const wrapper = document.createElement(tag);\n  if (className) wrapper.className = className;\n  if (id) wrapper.id = id;\n  if(style) {\n    if (style.display) wrapper.style.display = style.display;\n    if (style.overflow) wrapper.style.overflow = style.overflow;\n  }\n\n  const parentNode = element.parentNode;\n  if (!parentNode) {\n    throw new Error('element does not have a parent node');\n  }\n  parentNode.insertBefore(wrapper, element);\n  parentNode.removeChild(element);\n  wrapper.appendChild(element);\n  return wrapper;\n}\n\n\nexport function unwrap(element: HTMLElement) {\n  const parent = element.parentNode as HTMLElement;\n\n  if (parent && parent !== document.body) {\n    parent.parentNode?.insertBefore(element, parent);\n    parent.parentNode?.removeChild(parent);\n  }\n}\n\nexport function remove(elements: NodeListOf<Element>): void {\n  const elmArray = toArray(elements);\n  elmArray.forEach((element : any) => {\n    if (element.parentNode) {\n      element.parentNode.removeChild(element);\n    }\n  });\n}\n\nexport function clamp(num: number, min: number, max: number): number {\n  return Math.min(Math.max(num, min), max);\n}\n\nexport function assignEvent(\n    element: HTMLElement,\n    events: string | string[],\n    handler: any,\n): () => void {\n  const eventList = Array.isArray(events) ? events : [events];\n  eventList.forEach((event) => element.addEventListener(event, handler));\n\n  return () => {\n    eventList.forEach((event) => element.removeEventListener(event, handler));\n  };\n}\n\nexport function getTouchPointsDistance(touches: TouchList): number {\n  const touch0 = touches[0];\n  const touch1 = touches[1];\n  return Math.sqrt(\n      Math.pow(touch1.pageX - touch0.pageX, 2) +\n      Math.pow(touch1.pageY - touch0.pageY, 2),\n  );\n}\n","import { noop } from './util';\n\nclass Slider {\n   private onStart: any;\n   private onMove: any;\n   private onEnd: any;\n   private isSliderEnabled: any;\n   private container: any;\n   private touchMoveEvent: string | undefined;\n   private touchEndEvent: string |undefined;\n   private sx!: number;\n   private sy!: number;\n  constructor (container: any, {\n    onStart, onMove, onEnd, isSliderEnabled,\n  }: {\n    onStart?:(x: any, y: { x: number; y: number }) => void;\n    onMove?: (x: any, y: { dx: number; dy: number; mx: number; my: number }) => void;\n    onEnd?: () => void;\n    isSliderEnabled?: any;\n  }) {\n    this.container = container;\n    this.isSliderEnabled = isSliderEnabled;\n    this.onStart = onStart || noop;\n    this.onMove = onMove || noop;\n    this.onEnd = onEnd || noop;\n  }\n\n  startHandler = (eStart: Event) => {\n    if (!this.isSliderEnabled()) return;\n\n    this.removeListeners();\n\n    eStart.preventDefault();\n\n    const { moveHandler, endHandler, onStart } = this;\n\n    const isTouchEvent = eStart.type === 'touchstart' || eStart.type === 'touchend';\n\n    let sx: number;\n    let sy: number;\n    if (isTouchEvent) {\n      const touchEvent = eStart as TouchEvent; // Cast to TouchEvent type\n      this.touchMoveEvent = 'touchmove';\n      this.touchEndEvent = 'touchend';\n      sx = touchEvent.touches[0].clientX;\n      sy = touchEvent.touches[0].clientY;\n    } else {\n      const mouseEvent = eStart as MouseEvent; // Cast to MouseEvent type\n      this.touchMoveEvent = 'mousemove';\n      this.touchEndEvent = 'mouseup';\n      sx = mouseEvent.clientX;\n      sy = mouseEvent.clientY;\n    }\n    this.sx = sx;\n    this.sy = sy;\n\n    onStart(eStart, {\n      x: this.sx,\n      y: this.sy,\n    });\n\n    // add listeners\n    document.addEventListener(this.touchMoveEvent, moveHandler);\n    document.addEventListener(this.touchEndEvent, endHandler);\n    /*\n      add end handler in context menu as well.\n      As mouseup event is not trigger on context menu open\n      https://bugs.chromium.org/p/chromium/issues/detail?id=506801\n    */\n    document.addEventListener('contextmenu', endHandler);\n  };\n\n  moveHandler = (eMove: Event) => {\n    if (!this.isSliderEnabled()) return;\n\n    eMove.preventDefault();\n    const { sx, sy, onMove } = this;\n\n    const isTouchEvent = this.touchMoveEvent === 'touchmove';\n\n    // get the coordinates\n    let mx:number;\n    let my:number;\n    if (isTouchEvent) {\n      const touchEvent = eMove as TouchEvent; // Cast to TouchEvent type\n      mx = touchEvent.touches[0].clientX;\n      my = touchEvent.touches[0].clientY;\n    } else {\n      const mouseEvent = eMove as MouseEvent; // Cast to MouseEvent type\n      mx = mouseEvent.clientX;\n      my = mouseEvent.clientY;\n    }\n\n\n    onMove(eMove, {\n      dx: mx - sx,\n      dy: my - sy,\n      mx,\n      my,\n    });\n  };\n\n  endHandler = () => {\n    if (!this.isSliderEnabled()) return;\n    this.removeListeners();\n    this.onEnd();\n  };\n\n  // remove previous events if it's not removed\n  // - Case when while sliding mouse moved out of document and released there\n  removeListeners () {\n    if (this.touchMoveEvent) document.removeEventListener(this.touchMoveEvent, this.moveHandler);\n    if (this.touchEndEvent) document.removeEventListener(this.touchEndEvent, this.endHandler);\n    document.removeEventListener('contextmenu', this.endHandler);\n  }\n\n  init () {\n    ['touchstart', 'mousedown'].forEach((evt) => {\n      this.container.addEventListener(evt, this.startHandler);\n    });\n  }\n\n  destroy () {\n    ['touchstart', 'mousedown'].forEach((evt) => {\n      this.container.removeEventListener(evt, this.startHandler);\n    });\n    this.removeListeners();\n  }\n}\n\nexport default Slider;\n","import {\n  createElement,\n  addClass,\n  removeClass,\n  css,\n  removeCss,\n  wrap,\n  unwrap,\n  remove,\n  easeOutQuart,\n  imageLoaded,\n  clamp,\n  assignEvent,\n  getTouchPointsDistance,\n  ZOOM_CONSTANT,\n  MOUSE_WHEEL_COUNT,\n} from './util';\n\n\nimport Slider from './Slider';\nimport FullScreenViewer from \"./FullScreen\";\n\n\nclass ImageViewer {\n  static defaults: any;\n  static FullScreenViewer: typeof FullScreenViewer;\n  _ev: any;\n  protected _elements: any;\n  protected _events: {\n    pinchStart?: () => void;\n    zoomOutClick?: () => void;\n    zoomInClick?: () => void;\n    mouseLeaveSnapView?: () => void;\n    mouseEnterSnapView?: () => void;\n    imageLoad?: () => void;\n    imageError?: () => void;\n    hiResImageLoad?: () => void;\n    snapViewOnMouseMove?: () => void;\n    onWindowResize?: () => void;\n    onCloseBtnClick?: () => void;\n    pinchMove?: () => void;\n    pinchEnd?: () => void;\n  };\n  private _options: {\n    zoomStep?: number;\n    zoomOnMouseWheel?: boolean;\n    refreshOnResize?: any;\n    snapView: boolean;\n    zoomValue: any;\n    maxZoom: number;\n    hasZoomButtons: any;\n    listeners: any;\n  };\n  private _listeners: any;\n  private _state: {\n    zoomSliderLength?: number;\n    snapHandleDim?: { w: number; h: number };\n    zooming?: boolean;\n    snapViewVisible?: boolean;\n    zoomValue?: any\n    loaded?: any\n    imageDim?: any\n    containerDim?: any\n    snapImageDim?: any\n  };\n  private _sliders: {\n    snapSlider?: any; imageSlider?: any; zoomSlider?: any;\n  };\n  private _frames: {\n    slideMomentumCheck?: NodeJS.Timeout;\n    zoomFrame?: number;\n    snapViewTimeout?: NodeJS.Timeout;\n    sliderMomentumFrame?: number;\n  };\n  private _images: { hiResImageSrc: any; imageSrc: any };\n\n  constructor(element: any, options = {}) {\n    const {container, domElement, imageSrc, hiResImageSrc} = this._findContainerAndImageSrc(element);\n\n\n    // containers for elements\n    this._elements = {\n      container, domElement,\n    };\n\n\n    this._options = {...ImageViewer.defaults, ...options};\n\n\n    // container for all events\n    this._events = {};\n\n\n    this._listeners = this._options.listeners || {};\n\n\n    // container for all timeout and frames\n    this._frames = {};\n\n\n    // container for all sliders\n    this._sliders = {};\n\n\n    // maintain current state\n    this._state = {\n      zoomValue: this._options.zoomValue,\n    };\n\n\n    this._images = {\n      imageSrc, hiResImageSrc,\n    };\n\n\n    this._init();\n\n\n    if (imageSrc) {\n      this._loadImages();\n    }\n\n\n    // store reference of imageViewer in domElement\n    domElement._imageViewer = this;\n  }\n\n  get zoomInButton() {\n    return this._options.hasZoomButtons ? `<div class=\"iv-button-zoom--in\" role=\"button\"></div>` : '';\n  }\n\n  get zoomOutButton() {\n    return this._options.hasZoomButtons ? `<div class=\"iv-button-zoom--out\" role=\"button\"></div>` : '';\n  }\n\n  get imageViewHtml() {\n    return `\n  <div class=\"iv-loader\"></div>\n  <div class=\"iv-snap-view\">\n    <div class=\"iv-snap-image-wrap\">\n      <div class=\"iv-snap-handle\"></div>\n    </div>\n    <div class=\"iv-zoom-actions ${this._options.hasZoomButtons ? 'iv-zoom-actions--has-buttons' : ''}\">\n      ${this.zoomInButton}\n      <div class=\"iv-zoom-slider\">\n        <div class=\"iv-zoom-handle\"></div>\n      </div>\n      ${this.zoomOutButton}\n    </div>\n  </div>\n  <div class=\"iv-image-view\" >\n    <div class=\"iv-image-wrap\" ></div>\n  </div>\n`;\n  }\n\n  /**\n   * Data will be passed to the callback registered with each new instance\n   */\n  get _callbackData(): {\n    container: HTMLElement;\n    snapView: HTMLElement;\n    zoomValue: number;\n    reachedMin: boolean;\n    reachedMax: boolean;\n    instance: ImageViewer;\n  } {\n    return {\n      container: this._elements.container,\n      snapView: this._elements.snapView,\n      zoomValue: this._state.zoomValue,\n      reachedMin: Math.round(this._state.zoomValue) === this._options.zoomValue,\n      reachedMax: Math.round(this._state.zoomValue) === this._options.maxZoom,\n      instance: this,\n    };\n  }\n\n  _findContainerAndImageSrc(element: any) {\n    let domElement = element;\n    let imageSrc, hiResImageSrc;\n\n\n    if (typeof element === 'string') {\n      domElement = document.querySelector(element) as HTMLElement;\n    }\n\n\n    // throw error if imageViewer is already assigned\n    if (domElement._imageViewer) {\n      throw new Error('An image viewer is already being initiated on the element.');\n    }\n\n\n    let container = element;\n\n\n    if (domElement.tagName === 'IMG') {\n      imageSrc = domElement.src;\n      hiResImageSrc = domElement.getAttribute('high-res-src') || domElement.getAttribute('data-high-res-src');\n\n\n      // wrap the image with iv-container div\n      container = wrap(domElement, {\n        className: 'iv-container iv-image-mode', style: {display: 'inline-block', overflow: 'hidden'}\n      });\n\n\n      // hide the image and add iv-original-img class\n      css(domElement, {\n        opacity: 0, position: 'relative', zIndex: -1,\n      });\n    } else {\n      imageSrc = domElement.getAttribute('src') || domElement.getAttribute('data-src');\n      hiResImageSrc = domElement.getAttribute('high-res-src') || domElement.getAttribute('data-high-res-src');\n    }\n\n\n    return {\n      container, domElement, imageSrc, hiResImageSrc,\n    };\n  }\n\n  _init() {\n    // initialize the dom elements\n    this._initDom();\n\n\n    // initialize slider\n    this._initImageSlider();\n    this._initSnapSlider();\n    this._initZoomSlider();\n\n\n    // enable pinch and zoom feature for touch screens\n    this._pinchAndZoom();\n\n\n    // enable scroll zoom interaction\n    this._scrollZoom();\n\n\n    // enable double tap to zoom interaction\n    this._doubleTapToZoom();\n\n\n    // initialize events\n    this._initEvents();\n  }\n\n  _initDom() {\n    const {container} = this._elements;\n\n\n    // add image-viewer layout elements\n    createElement({\n      tagName: 'div', className: 'iv-wrap', html: this.imageViewHtml, parent: container,\n    });\n\n\n    // add container class on the container\n    addClass(container, 'iv-container');\n\n\n    // if the element is static position, position it relatively\n    if (css(container, 'position') === 'static') {\n      css(container, {position: 'relative'});\n    }\n\n\n    // save references for later use\n    this._elements = {\n      ...this._elements,\n      snapView: container.querySelector('.iv-snap-view'),\n      snapImageWrap: container.querySelector('.iv-snap-image-wrap'),\n      imageWrap: container.querySelector('.iv-image-wrap'),\n      snapHandle: container.querySelector('.iv-snap-handle'),\n      zoomHandle: container.querySelector('.iv-zoom-handle'),\n      zoomIn: container.querySelector('.iv-button-zoom--in'),\n      zoomOut: container.querySelector('.iv-button-zoom--out'),\n    };\n\n\n    if (this._listeners.onInit) {\n      this._listeners.onInit(this._callbackData);\n    }\n  }\n\n  _initImageSlider() {\n    const {\n      _elements,\n    } = this;\n\n\n    const {imageWrap} = _elements;\n\n\n    let positions: any, currentPos: any;\n\n\n    /* Add slide interaction to image */\n    const imageSlider = new Slider(imageWrap, {\n      isSliderEnabled: () => {\n        const {loaded, zooming, zoomValue} = this._state;\n        return loaded && !zooming && zoomValue > 100;\n      }, onStart: (_, position) => {\n        const {snapSlider} = this._sliders;\n\n\n        // clear all animation frame and interval\n        this._clearFrames();\n\n\n        snapSlider.onStart();\n\n\n        // reset positions\n        positions = [position, position];\n        currentPos = undefined;\n\n\n        this._frames.slideMomentumCheck = setInterval(() => {\n          if (!currentPos) return;\n\n\n          positions.shift();\n          positions.push({\n            x: currentPos.mx, y: currentPos.my,\n          });\n        }, 50);\n      }, onMove: (e, position) => {\n        const {snapImageDim} = this._state;\n        const {snapSlider} = this._sliders;\n        const imageCurrentDim = this._getImageCurrentDim();\n        currentPos = position;\n\n\n        snapSlider.onMove(e, {\n          dx: -position.dx * snapImageDim.w / imageCurrentDim.w, dy: -position.dy * snapImageDim.h / imageCurrentDim.h,\n        });\n      }, onEnd: () => {\n        const {snapImageDim} = this._state;\n        const {snapSlider} = this._sliders;\n        const imageCurrentDim = this._getImageCurrentDim();\n\n\n        // clear all animation frame and interval\n        this._clearFrames();\n\n\n        let step: number, positionX: number, positionY: number;\n\n\n        const xDiff = positions[1].x - positions[0].x;\n        const yDiff = positions[1].y - positions[0].y;\n\n\n        const momentum = () => {\n          if (step <= 60) {\n            this._frames.sliderMomentumFrame = requestAnimationFrame(momentum);\n          }\n\n\n          positionX += easeOutQuart(step, xDiff / 3, -xDiff / 3, 60);\n          positionY += easeOutQuart(step, yDiff / 3, -yDiff / 3, 60);\n\n\n          snapSlider.onMove(null, {\n            dx: -(positionX * snapImageDim.w / imageCurrentDim.w),\n            dy: -(positionY * snapImageDim.h / imageCurrentDim.h),\n          });\n\n\n          step++;\n        };\n\n\n        if (Math.abs(xDiff) > 30 || Math.abs(yDiff) > 30) {\n          step = 1;\n          positionX = currentPos.dx;\n          positionY = currentPos.dy;\n\n\n          momentum();\n        }\n      },\n    });\n\n\n    imageSlider.init();\n\n\n    this._sliders.imageSlider = imageSlider;\n  }\n\n  _initSnapSlider() {\n    const {\n      snapHandle,\n    } = this._elements;\n\n\n    let startHandleTop: any, startHandleLeft: any;\n\n\n    const snapSlider = new Slider(snapHandle, {\n      isSliderEnabled: () => {\n        return this._state.loaded;\n      }, onStart: () => {\n        const {slideMomentumCheck, sliderMomentumFrame} = this._frames;\n\n\n        startHandleTop = parseFloat(<string>css(snapHandle, 'top'));\n        startHandleLeft = parseFloat(<string>css(snapHandle, 'left'));\n\n\n        // stop momentum on image\n        if(slideMomentumCheck) clearInterval(slideMomentumCheck);\n        if (typeof sliderMomentumFrame === \"number\") {\n          cancelAnimationFrame(sliderMomentumFrame);\n        }\n      }, onMove: (_, position) => {\n        const {snapHandleDim, snapImageDim} = this._state;\n        const {image} = this._elements;\n\n\n        const imageCurrentDim = this._getImageCurrentDim();\n\n\n        if (!snapHandleDim) return;\n        // find handle left and top and make sure they lay between the snap image\n        const maxLeft = Math.max(snapImageDim.w - snapHandleDim.w, startHandleLeft);\n        const maxTop = Math.max(snapImageDim.h - snapHandleDim.h, startHandleTop);\n        const minLeft = Math.min(0, startHandleLeft);\n        const minTop = Math.min(0, startHandleTop);\n\n\n        const left = clamp(startHandleLeft + position.dx, minLeft, maxLeft);\n        const top = clamp(startHandleTop + position.dy, minTop, maxTop);\n\n\n        const imgLeft = -left * imageCurrentDim.w / snapImageDim.w;\n        const imgTop = -top * imageCurrentDim.h / snapImageDim.h;\n\n\n        css(snapHandle, {\n          left: `${left}px`, top: `${top}px`,\n        });\n\n\n        css(image, {\n          left: `${imgLeft}px`, top: `${imgTop}px`,\n        });\n      },\n    });\n\n\n    snapSlider.init();\n\n\n    this._sliders.snapSlider = snapSlider;\n  }\n\n  _initZoomSlider() {\n    const {snapView, zoomHandle} = this._elements;\n\n\n    // zoom in zoom out using zoom handle\n    const sliderElm = snapView.querySelector('.iv-zoom-slider');\n\n\n    let leftOffset: number, handleWidth: number;\n\n\n    // on zoom slider we have to follow the mouse and set the handle to its position.\n    const zoomSlider = new Slider(sliderElm, {\n      isSliderEnabled: () => {\n        return this._state.loaded;\n      }, onStart: (eStart) => {\n        const {zoomSlider: slider} = this._sliders;\n\n\n        leftOffset = sliderElm.getBoundingClientRect().left + document.body.scrollLeft;\n        handleWidth = parseInt(<string>css(zoomHandle, 'width'), 10);\n\n\n        // move the handle to current mouse position\n        slider.onMove(eStart);\n      }, onMove: (e) => {\n        const {maxZoom} = this._options;\n        const {zoomSliderLength} = this._state;\n\n\n        const pageX = e.pageX !== undefined ? e.pageX : e.touches[0].pageX;\n\n\n        if (!zoomSliderLength) return;\n        const newLeft = clamp(pageX - leftOffset - handleWidth / 2, 0, zoomSliderLength);\n        const zoomValue = 100 + ((maxZoom - 100) * newLeft / zoomSliderLength);\n\n\n        this.zoom(zoomValue);\n      },\n    });\n\n\n    zoomSlider.init();\n    this._sliders.zoomSlider = zoomSlider;\n  }\n\n  _initEvents() {\n    this._snapViewEvents();\n\n\n    // handle window resize\n    if (this._options.refreshOnResize) {\n      this._events.onWindowResize = assignEvent(window as any as HTMLElement, 'resize', this.refresh);\n    }\n  }\n\n  _snapViewEvents() {\n    const {imageWrap, snapView} = this._elements;\n\n\n    // show snapView on mouse move\n    this._events.snapViewOnMouseMove = assignEvent(imageWrap, ['touchmove', 'mousemove'], () => {\n      this.showSnapView();\n    });\n\n\n    // keep showing snapView if on hover over it without any timeout\n    this._events.mouseEnterSnapView = assignEvent(snapView, ['mouseenter', 'touchstart'], () => {\n      this._state.snapViewVisible = false;\n      this.showSnapView(true);\n    });\n\n\n    // on mouse leave set timeout to hide snapView\n    this._events.mouseLeaveSnapView = assignEvent(snapView, ['mouseleave', 'touchend'], () => {\n      this._state.snapViewVisible = false;\n      this.showSnapView();\n    });\n\n\n    if (!this._options.hasZoomButtons) {\n      return;\n    }\n    const {zoomOut, zoomIn} = this._elements;\n\n\n    this._events.zoomInClick = assignEvent(zoomIn, ['click'], () => {\n      this.zoom(this._state.zoomValue + (this._options.zoomStep || 50));\n    });\n\n\n    this._events.zoomOutClick = assignEvent(zoomOut, ['click'], () => {\n      this.zoom(this._state.zoomValue - (this._options.zoomStep || 50));\n    });\n  }\n\n  _pinchAndZoom() {\n    const {imageWrap, container} = this._elements;\n\n\n    // apply pinch and zoom feature\n    const onPinchStart = (eStart: TouchEvent) => {\n      const {loaded, zoomValue: startZoomValue} = this._state;\n      const {_events: events} = this;\n\n\n      if (!loaded) return;\n\n\n      const touch0 = eStart.touches[0];\n      const touch1 = eStart.touches[1];\n\n\n      if (!(touch0 && touch1)) {\n        return;\n      }\n\n\n      this._state.zooming = true;\n\n\n      const contOffset = container.getBoundingClientRect();\n\n\n      // find distance between two touch points\n      const startDist = getTouchPointsDistance(eStart.touches);\n\n\n      // find the center for the zoom\n      const center = {\n        x: (touch1.pageX + touch0.pageX) / 2 - (contOffset.left + document.body.scrollLeft),\n        y: (touch1.pageY + touch0.pageY) / 2 - (contOffset.top + document.body.scrollTop),\n      };\n\n\n      const moveListener = (eMove: TouchEvent) => {\n        // eMove.preventDefault();\n\n\n        const newDist = getTouchPointsDistance(eMove.touches);\n\n\n        const zoomValue = startZoomValue + (newDist - startDist) / 2;\n\n\n        this.zoom(zoomValue, center);\n      };\n\n\n      const endListener = (eEnd: TouchEvent) => {\n        // unbind events\n        if (events.pinchMove) events.pinchMove();\n        if (events.pinchEnd) events.pinchEnd();\n        this._state.zooming = false;\n        // properly resume move event if one finger remains\n        if (eEnd.touches.length === 1) {\n          this._sliders.imageSlider.startHandler(eEnd);\n        }\n      };\n\n\n      // remove events if already assigned\n      if (events.pinchMove) events.pinchMove();\n      if (events.pinchEnd) events.pinchEnd();\n\n\n      // assign events\n      events.pinchMove = assignEvent(document as any as HTMLElement, 'touchmove', moveListener);\n      events.pinchEnd = assignEvent(document as any as HTMLElement, 'touchend', endListener);\n    };\n\n\n    this._events.pinchStart = assignEvent(imageWrap, 'touchstart', onPinchStart);\n  }\n\n  _scrollZoom() {\n    /* Add zoom interaction in mouse wheel */\n    const {_options} = this;\n    const {container, imageWrap} = this._elements;\n\n\n    let changedDelta = 0;\n\n\n    const onMouseWheel = (e: WheelEvent) => {\n      const {loaded, zoomValue} = this._state;\n\n\n      if (!_options.zoomOnMouseWheel || !loaded) return;\n\n\n      // clear all animation frame and interval\n      this._clearFrames();\n\n\n      // cross-browser wheel delta\n      // eslint-disable-next-line @typescript-eslint/ban-ts-comment\n      // @ts-ignore\n      const delta = Math.max(-1, Math.min(1, e.wheelDelta || -e.detail || -e.deltaY));\n\n\n      const newZoomValue = zoomValue * (100 + delta * ZOOM_CONSTANT) / 100;\n\n\n      if (!(newZoomValue >= 100 && newZoomValue <= _options.maxZoom)) {\n        changedDelta += Math.abs(delta);\n      } else {\n        changedDelta = 0;\n      }\n\n\n      e.preventDefault();\n\n\n      if (changedDelta > MOUSE_WHEEL_COUNT) return;\n\n\n      const contOffset = container.getBoundingClientRect();\n\n\n      const x = (e.pageX || e.pageX) - (contOffset.left + document.body.scrollLeft);\n      const y = (e.pageY || e.pageY) - (contOffset.top + document.body.scrollTop);\n\n\n      this.zoom(newZoomValue, {\n        x, y,\n      });\n\n\n      // show the snap viewer\n      this.showSnapView();\n    };\n\n\n    this._ev = assignEvent(imageWrap, 'wheel', onMouseWheel);\n  }\n\n  _doubleTapToZoom() {\n    const {imageWrap} = this._elements;\n    // handle double tap for zoom in and zoom out\n\n\n    let touchTime = 0;\n\n\n    let point: { x: number, y: number };\n\n\n    const onDoubleTap = (e: MouseEvent) => {\n      if (touchTime === 0) {\n        touchTime = Date.now();\n        point = {\n          x: e.pageX, y: e.pageY,\n        };\n      } else if (Date.now() - touchTime < 500 && Math.abs(e.pageX - point.x) < 50 && Math.abs(e.pageY - point.y) < 50) {\n        if (this._state.zoomValue === this._options.zoomValue) {\n          this.zoom(200);\n        } else {\n          this.resetZoom();\n        }\n        touchTime = 0;\n      } else {\n        touchTime = 0;\n      }\n    };\n\n\n    assignEvent(imageWrap, 'click', onDoubleTap);\n  }\n\n  _getImageCurrentDim() {\n    const {zoomValue, imageDim} = this._state;\n    return {\n      w: imageDim.w * (zoomValue / 100), h: imageDim.h * (zoomValue / 100),\n    };\n  }\n\n  _loadImages() {\n    const {_images, _elements} = this;\n    const {imageSrc, hiResImageSrc} = _images;\n    const {container, snapImageWrap, imageWrap} = _elements;\n\n\n    const ivLoader = container.querySelector('.iv-loader');\n\n\n    // remove old images\n    remove(container.querySelectorAll('.iv-snap-image, .iv-image'));\n\n\n    // add snapView image\n    const snapImage = createElement({\n      tagName: 'img', className: 'iv-snap-image', insertBefore: snapImageWrap.firstChild, parent: snapImageWrap,\n    });\n    (snapImage as HTMLImageElement).src = String(imageSrc);\n\n\n    // add image\n    const image = createElement({\n      tagName: 'img', className: 'iv-image iv-small-image', parent: imageWrap,\n    });\n    (image as HTMLImageElement).src = String(imageSrc);\n\n\n    this._state.loaded = false;\n    // store image reference in _elements\n    this._elements.image = image;\n    this._elements.snapImage = snapImage;\n    css(ivLoader, {display: 'block'});\n\n\n    // keep visibility hidden until image is loaded\n    css(image, {visibility: 'hidden'});\n    // hide snap view if open\n    this.hideSnapView();\n    const onImageLoad = () => {\n      // hide the iv loader\n      css(ivLoader, {display: 'none'});\n\n\n      // show the image\n      css(image, {visibility: 'visible'});\n\n\n      // load high resolution image if provided\n      if (hiResImageSrc) {\n        this._loadHighResImage(hiResImageSrc);\n      }\n\n\n      // set loaded flag to true\n      this._state.loaded = true;\n\n\n      // calculate the dimension\n      this._calculateDimensions();\n\n      // dispatch image load event\n      if (this._listeners.onImageLoaded) {\n        this._listeners.onImageLoaded(this._callbackData);\n      }\n\n\n      // reset the zoom\n      this.resetZoom();\n    };\n\n\n    const onImageError = (e: any) => {\n      css(ivLoader, {display: 'none'});\n      if (this._listeners.onImageError) {\n        this._listeners.onImageError(e);\n      }\n    }\n\n\n    if (imageLoaded(image)) {\n      onImageLoad();\n    } else {\n      this._events.imageLoad = assignEvent(image, 'load', onImageLoad);\n      this._events.imageError = assignEvent(image, 'error', onImageError);\n    }\n  }\n\n  _loadHighResImage(hiResImageSrc: string) {\n    const {imageWrap, container} = this._elements;\n\n\n    const lowResImg = this._elements.image;\n\n\n    const hiResImage = createElement({\n      tagName: 'img',\n      className: 'iv-image iv-large-image',\n      src: hiResImageSrc,\n      parent: imageWrap,\n      style: lowResImg.style.cssText,\n    });\n\n\n    // add all the style attributes from lowResImg to highResImg\n    hiResImage.style.cssText = lowResImg.style.cssText;\n\n\n    this._elements.image = container.querySelectorAll('.iv-image');\n\n\n    const onHighResImageLoad = () => {\n      // remove the low size image and set this image as default image\n      remove(lowResImg);\n      this._elements.image = hiResImage;\n      // this._calculateDimensions();\n    };\n\n\n    if (imageLoaded(hiResImage)) {\n      onHighResImageLoad();\n    } else {\n      this._events.hiResImageLoad = assignEvent(hiResImage, 'load', onHighResImageLoad);\n    }\n  }\n\n  _calculateDimensions() {\n    const {image, container, snapView, snapImage, zoomHandle} = this._elements;\n\n\n    // calculate content width of image and snap image\n    const imageWidth = parseInt(<string>css(image, 'width'), 10);\n    const imageHeight = parseInt(<string>css(image, 'height'), 10);\n\n\n    const contWidth = parseInt(<string>css(container, 'width'), 10);\n    const contHeight = parseInt(<string>css(container, 'height'), 10);\n\n\n    const snapViewWidth = snapView.clientWidth;\n    const snapViewHeight = snapView.clientHeight;\n\n\n    // set the container dimension\n    this._state.containerDim = {\n      w: contWidth, h: contHeight,\n    };\n\n\n    const imgOriginWidth = image.naturalWidth || imageWidth\n    const imgOriginHeight = image.naturalHeight || imageHeight;\n\n\n    const ratio = imgOriginWidth / imgOriginHeight;\n    // set the image dimension\n    const imgWidth = (imgOriginWidth > imgOriginHeight && contHeight >= contWidth) || ratio * contHeight > contWidth ? contWidth : ratio * contHeight;\n\n\n    const imgHeight = imgWidth / ratio;\n\n\n    this._state.imageDim = {\n      w: imgWidth, h: imgHeight,\n    };\n\n\n    // reset image position and zoom\n    css(image, {\n      width: `${imgWidth}px`,\n      height: `${imgHeight}px`,\n      left: `${(contWidth - imgWidth) / 2}px`,\n      top: `${(contHeight - imgHeight) / 2}px`,\n      maxWidth: 'none',\n      maxHeight: 'none',\n    });\n\n\n    // set the snap Image dimension\n    const snapWidth = imgWidth > imgHeight ? snapViewWidth : imgWidth * snapViewHeight / imgHeight;\n    const snapHeight = imgHeight > imgWidth ? snapViewHeight : imgHeight * snapViewWidth / imgWidth;\n\n\n    this._state.snapImageDim = {\n      w: snapWidth, h: snapHeight,\n    };\n\n\n    css(snapImage, {\n      width: `${snapWidth}px`, height: `${snapHeight}px`,\n    });\n\n\n    const zoomSlider = snapView.querySelector('.iv-zoom-slider').clientWidth;\n    // calculate zoom slider area\n    this._state.zoomSliderLength = zoomSlider - zoomHandle.offsetWidth;\n  }\n\n  resetZoom(animate = true) {\n    const {zoomValue} = this._options;\n\n\n    if (!animate) {\n      this._state.zoomValue = zoomValue;\n    }\n\n\n    this.zoom(zoomValue);\n  }\n\n  zoom = (perc: number, point?: any) => {\n    const {_options, _elements, _state} = this;\n    const {zoomValue: curPerc, imageDim, containerDim, zoomSliderLength} = _state;\n    const {image, zoomHandle} = _elements;\n    const {maxZoom} = _options;\n\n\n    perc = Math.round(Math.max(100, perc));\n    perc = Math.min(maxZoom, perc);\n\n\n    point = point || {\n      x: containerDim.w / 2, y: containerDim.h / 2,\n    };\n\n\n    const curLeft = parseFloat(<string>css(image, 'left'));\n    const curTop = parseFloat(<string>css(image, 'top'));\n\n\n    // clear any panning frames\n    this._clearFrames();\n\n\n    let step = 0;\n\n\n    const baseLeft = (containerDim.w - imageDim.w) / 2;\n    const baseTop = (containerDim.h - imageDim.h) / 2;\n    const baseRight = containerDim.w - baseLeft;\n    const baseBottom = containerDim.h - baseTop;\n\n\n    const zoom = () => {\n      step++;\n\n\n      if (step < 16) {\n        this._frames.zoomFrame = requestAnimationFrame(zoom);\n      }\n\n\n      const tickZoom = easeOutQuart(step, curPerc, perc - curPerc, 16);\n      const ratio = tickZoom / curPerc;\n\n\n      const imgWidth = imageDim.w * tickZoom / 100;\n      const imgHeight = imageDim.h * tickZoom / 100;\n\n\n      let newLeft = -((point.x - curLeft) * ratio - point.x);\n      let newTop = -((point.y - curTop) * ratio - point.y);\n\n\n      // fix for left and top\n      newLeft = Math.min(newLeft, baseLeft);\n      newTop = Math.min(newTop, baseTop);\n\n\n      // fix for right and bottom\n      if (newLeft + imgWidth < baseRight) {\n        newLeft = baseRight - imgWidth; // newLeft - (newLeft + imgWidth - baseRight)\n      }\n\n\n      if (newTop + imgHeight < baseBottom) {\n        newTop = baseBottom - imgHeight; // newTop + (newTop + imgHeight - baseBottom)\n      }\n\n\n      css(image, {\n        height: `${imgHeight}px`, width: `${imgWidth}px`, left: `${newLeft}px`, top: `${newTop}px`,\n      });\n\n\n      this._state.zoomValue = tickZoom;\n\n\n      this._resizeSnapHandle(imgWidth, imgHeight, newLeft, newTop);\n\n\n      // update zoom handle position\n      css(zoomHandle, {\n        left: `${(tickZoom - 100) * (zoomSliderLength || 0) / (maxZoom - 100)}px`,\n      });\n\n\n      // dispatch zoom changed event\n      if (this._listeners.onZoomChange) {\n        this._listeners.onZoomChange(this._callbackData);\n      }\n    };\n\n\n    zoom();\n  };\n\n  _clearFrames = () => {\n    const { slideMomentumCheck, sliderMomentumFrame, zoomFrame } = this._frames;\n\n    if(slideMomentumCheck) clearInterval(slideMomentumCheck);\n    if (typeof sliderMomentumFrame === 'number') {\n      cancelAnimationFrame(sliderMomentumFrame);\n    }\n    if (typeof zoomFrame === 'number') {\n      cancelAnimationFrame(zoomFrame);\n    }\n  };\n\n\n  _resizeSnapHandle = (imgWidth: number, imgHeight: number, imgLeft: number, imgTop: number) => {\n    const {_elements, _state} = this;\n    const {snapHandle, image} = _elements;\n    const {imageDim, containerDim, zoomValue, snapImageDim} = _state;\n\n\n    const imageWidth = imgWidth || imageDim.w * zoomValue / 100;\n    const imageHeight = imgHeight || imageDim.h * zoomValue / 100;\n    const imageLeft = imgLeft || parseFloat(<string>css(image, 'left'));\n    const imageTop = imgTop || parseFloat(<string>css(image, 'top'));\n\n\n    const left = -imageLeft * snapImageDim.w / imageWidth;\n    const top = -imageTop * snapImageDim.h / imageHeight;\n\n\n    const handleWidth = (containerDim.w * snapImageDim.w) / imageWidth;\n    const handleHeight = (containerDim.h * snapImageDim.h) / imageHeight;\n\n\n    css(snapHandle, {\n      top: `${top}px`, left: `${left}px`, width: `${handleWidth}px`, height: `${handleHeight}px`,\n    });\n\n\n    this._state.snapHandleDim = {\n      w: handleWidth, h: handleHeight,\n    };\n  };\n\n  showSnapView = (noTimeout?: boolean) => {\n    const {snapViewVisible, zoomValue, loaded} = this._state;\n    const {snapView} = this._elements;\n\n\n    if (!this._options.snapView) return;\n\n\n    if (snapViewVisible || zoomValue <= 100 || !loaded) return;\n\n\n    clearTimeout(this._frames.snapViewTimeout);\n\n\n    this._state.snapViewVisible = true;\n\n\n    css(snapView, {opacity: 1, pointerEvents: 'inherit'});\n\n\n    if (!noTimeout) {\n      this._frames.snapViewTimeout = setTimeout(this.hideSnapView, 1500);\n    }\n  };\n\n  hideSnapView = () => {\n    const {snapView} = this._elements;\n    css(snapView, {opacity: 0, pointerEvents: 'none'});\n    this._state.snapViewVisible = false;\n  };\n\n  refresh = () => {\n    this._calculateDimensions();\n    this.resetZoom();\n  };\n\n  load(imageSrc: string, hiResImageSrc: string) {\n    this._images = {\n      imageSrc, hiResImageSrc,\n    };\n\n\n    this._loadImages();\n  }\n\n  destroy() {\n    const {container, domElement} = this._elements;\n    // destroy all the sliders\n    Object.entries(this._sliders).forEach(([, slider]: [string, Slider]) => {\n      slider.destroy();\n    });\n\n\n    // unbind all events\n    Object.entries(this._events).forEach(([, unbindEvent]: [string, () => void]) => {\n      unbindEvent();\n    });\n\n\n    // clear all the frames\n    this._clearFrames();\n\n\n    // remove html from the container\n    remove(container.querySelector('.iv-wrap'));\n\n\n    // remove iv-container class from container\n    removeClass(container, 'iv-container');\n\n\n    // remove added style from container\n    removeCss(document.querySelector('html') as HTMLElement, 'relative');\n\n\n    // if container has original image, unwrap the image and remove the class\n    // which will happen when domElement is not the container\n    if (domElement !== container) {\n      unwrap(domElement);\n    }\n\n\n    // remove imageViewer reference from dom element\n    domElement._imageViewer = null;\n\n\n    if (this._listeners.onDestroy) {\n      this._listeners.onDestroy();\n    }\n  }\n}\n\n\nImageViewer.defaults = {\n  zoomValue: 100,\n  snapView: true,\n  maxZoom: 500,\n  refreshOnResize: true,\n  zoomOnMouseWheel: true,\n  hasZoomButtons: false,\n  zoomStep: 50,\n  listeners: {\n    onInit: null, onDestroy: null, onImageLoaded: null, onZoomChange: null, onImageError: null\n  },\n};\n\n\nexport default ImageViewer;\n","import { createElement, assignEvent, css, remove, removeCss } from './util';\nimport ImageViewer from './ImageViewer';\n\nconst fullScreenHtml = `\n  <div class=\"iv-fullscreen-container\"></div>\n  <div class=\"iv-fullscreen-close\"></div>\n`;\n\nclass FullScreenViewer extends ImageViewer {\n  constructor (options = {}) {\n    const fullScreenElem = createElement({\n      tagName: 'div',\n      className: 'iv-fullscreen',\n      html: fullScreenHtml,\n      parent: document.body,\n    });\n\n    const container = fullScreenElem.querySelector('.iv-fullscreen-container');\n\n    // call the ImageViewer constructor\n    super(container, { ...options, refreshOnResize: false });\n\n    // add fullScreenElem on element list\n    this._elements.fullScreen = fullScreenElem;\n\n    this._initFullScreenEvents();\n  }\n  _initFullScreenEvents () {\n    const { fullScreen } = this._elements;\n    const closeBtn = fullScreen.querySelector('.iv-fullscreen-close') as HTMLElement;\n\n    // add close button event\n    this._events.onCloseBtnClick = assignEvent(closeBtn, 'click', this.hide);\n  }\n  show (imageSrc : string, hiResImageSrc: string) {\n    // show the element\n    css(this._elements.fullScreen, { display: 'block' });\n\n    // if image source is provide load image source\n    if (imageSrc) {\n      this.load(imageSrc, hiResImageSrc);\n    }\n\n    // handle window resize\n    this._events.onWindowResize = assignEvent(window  as any as HTMLElement, 'resize', this.refresh);\n\n    // disable scroll on html\n    css(document.querySelector('html') as HTMLElement, { overflow: 'hidden' });\n  }\n  hide = () => {\n    // hide the fullscreen\n    css(this._elements.fullScreen, { display: 'none' });\n\n    // enable scroll\n    removeCss(document.querySelector('html') as HTMLElement, 'overflow');\n\n    // remove window event\n    if (this._events.onWindowResize) this._events.onWindowResize();\n  };\n  destroy () {\n    const { fullScreen } = this._elements;\n\n    // destroy image viewer\n    super.destroy();\n\n    // remove the element\n    remove(fullScreen);\n  }\n}\n\nexport default FullScreenViewer;\n"],"names":["noop","easeOutQuart","currentTime","startValue","changedValue","duration","createElement","options","elem","escapedSrc","addClass","el","className","classNameAry","classItem","removeClass","imageLoaded","img","toArray","list","css","elements","properties","elmArray","element","key","removeCss","property","wrap","tag","id","style","wrapper","parentNode","unwrap","parent","remove","clamp","num","min","max","assignEvent","events","handler","eventList","event","getTouchPointsDistance","touches","touch0","touch1","Slider","container","onStart","onMove","onEnd","isSliderEnabled","eStart","moveHandler","endHandler","isTouchEvent","sx","sy","touchEvent","mouseEvent","eMove","mx","my","evt","ImageViewer","domElement","imageSrc","hiResImageSrc","_elements","imageWrap","positions","currentPos","imageSlider","loaded","zooming","zoomValue","_","position","snapSlider","e","snapImageDim","imageCurrentDim","step","positionX","positionY","xDiff","yDiff","momentum","snapHandle","startHandleTop","startHandleLeft","slideMomentumCheck","sliderMomentumFrame","snapHandleDim","image","maxLeft","maxTop","minLeft","minTop","left","top","imgLeft","imgTop","snapView","zoomHandle","sliderElm","leftOffset","handleWidth","zoomSlider","slider","maxZoom","zoomSliderLength","pageX","newLeft","zoomOut","zoomIn","onPinchStart","startZoomValue","contOffset","startDist","center","moveListener","newDist","endListener","eEnd","_options","changedDelta","onMouseWheel","delta","newZoomValue","x","y","touchTime","point","imageDim","_images","snapImageWrap","ivLoader","snapImage","onImageLoad","onImageError","lowResImg","hiResImage","onHighResImageLoad","imageWidth","imageHeight","contWidth","contHeight","snapViewWidth","snapViewHeight","imgOriginWidth","imgOriginHeight","ratio","imgWidth","imgHeight","snapWidth","snapHeight","animate","perc","_state","curPerc","containerDim","curLeft","curTop","baseLeft","baseTop","baseRight","baseBottom","zoom","tickZoom","newTop","zoomFrame","imageLeft","imageTop","handleHeight","noTimeout","snapViewVisible","unbindEvent","fullScreenHtml","FullScreenViewer","fullScreenElem","fullScreen","closeBtn"],"mappings":"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"}